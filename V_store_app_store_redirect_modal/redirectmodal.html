<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
</head>

<body style="background-color:blue;">

<!--SIMPLE SCRIPT TO TRANSFER IN CSS VALUES--> 
<script type="text/javascript">
 /**
 * Loads a CSS file from the supplied URL
 * @param {String} url    The URL of the CSS file, if its relative
                          it will be to the current page's url
 * @return {HTMLElement}  The <link> which was appended to the <head>
 */
 function loadcss(url) {
   var head = document.getElementsByTagName('head')[0],
   link = document.createElement('link');
   link.type = 'text/css';
   link.rel = 'stylesheet';
   link.href = url;
   head.appendChild(link);
   return link;
 }
 
 loadcss('http://app.thechessstore.com/redirectmodal.css');
 </script>
 
 <!--BEGIN MODAL FUNCTION SCRIPT-->
<script type="text/javascript">

//FUNCTIONS
function handleRedirect() {
	window.location = "http://app.thechessstore.com";
	console.log("var Function was added");
}
function bugLater(){
	sessionStorage.redirectToAppSessionNoCheck = true;
	$('.redirectToSiteApp').dialog('close');
	console.log("sessionStorage = " + sessionStorage.redirectToAppSessionNoCheck);
	console.log("localStorage = " + localStorage.redirectToAppVar);
}
function autoRedirect(){
	localStorage.redirectToAppVar = true;
	$('.redirectToSiteApp').dialog('close');
	window.location = "http://app.thechessstore.com";
}
function resetRedirectPreferences(){
	localStorage.redirectToAppVar = false;
	$(".stopFutureRedirectMessage").css("display", "block");
	console.log("sessionStorage have now been set to: " + sessionStorage.redirectToAppSessionNoCheck);
	console.log("localStorage have now been set to: " + localStorage.redirectToAppVar);
}


//SCRIPT BEGINS WHEN THE PAGE IS FULLY LOADED
$(document).ready(function() {
	//RESET FOR THE SESSION VARIABLE
	//sessionStorage.redirectToAppSessionNoCheck = false;
	
	
	if(typeof(Storage)!=="undefined"){
		if(localStorage.redirectToAppVar){
		}
		else{
			localStorage.redirectToAppVar = false;
		}
		if(sessionStorage.redirectToAppSessionNoCheck){
		}
		else{
			sessionStorage.redirectToAppSessionNoCheck = false;
		}
		$('<div class="redirectToSiteApp"> '+
		'<h3 style="float:left; text-align:center; width:100%;">Would you like to try out our new app site&#63;</h3>' +
		'<div style="width:100%; height:170px; float:left; clear:both;">' +
			'<img style="margin-left:110px;" src="logo.png" />' +
		'</div>' +
		'<button onclick="handleRedirect(); return false;" style="float:left;">Yes</button>' +
		'<button onclick="bugLater()" style="float:left; margin-left:128px;">Remind me next time</button>' +
		'<button onclick="autoRedirect()" style="float:left; margin-top:10px;">Always redirect to app site when visiting this site</button>' +
		//'<button onclick="resetRedirectPreferences()">Reset Preferences</button>' +
		'</div>').appendTo('head');
		
		if(typeof(Storage)!=="undefined"){
			console.log("storage exists check passed");
			if(localStorage.redirectToAppVar == "true"){
				$('<div style="background-color:white; float:left;" class="autoRedirectToSiteApp"> '+
				'<h3 style="float:left; text-align:center; width:100%;">Redirecting to app site. Please wait a few Seconds....</h3>' +
				'<div style="width:100% float:left; clear:both;">' +
					'<img style="margin-left:175px; margin-top:20px;" src="loading.gif.gif" />' +
				'</div>' +
				'<p class="stopFutureRedirectMessage" style="display:none; color:red; width:100%; text-align:center;">Done!</p>' +
				'<button style="float:left; margin-top:10px;" onclick="resetRedirectPreferences()">Prompt me next time instead of auto-redirecting</button>' +
				'</div>').appendTo('head');
				$('.autoRedirectToSiteApp').dialog({'modal':'true', 'width':400, height:270});
				function foo1(){
					window.location = "http://app.thechessstore.com";
				}
				var autoRedirectTimer;
				redirectTimer = foo1;
				autoRedirectTimer = setTimeout(redirectTimer, 5000);
			}
			else if (sessionStorage.redirectToAppSessionNoCheck == "true"){
				console.log("One of the two storage values was true, redirect modal is not displaying.");
			}
				else{
					$('.redirectToSiteApp').dialog({'modal':'true', 'width':450, height:430});
					console.log("Neither storage value was true, displaying redirect modal");
					console.log("sessionStorage = " + sessionStorage.redirectToAppSessionNoCheck);
					console.log("localStorage = " + localStorage.redirectToAppVar);
				}
		}
	}
	else{
		console.log("Storage is not supported");
	}
});
</script>
<div style=""></div>
</body>
</html>
