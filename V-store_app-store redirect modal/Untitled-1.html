<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>Untitled Document</title>
<script src="http://code.jquery.com/jquery-1.9.1.js"></script>
<script src="http://code.jquery.com/ui/1.10.3/jquery-ui.js"></script>
<link rel="stylesheet" href="http://code.jquery.com/ui/1.10.3/themes/smoothness/jquery-ui.css" />
</head>

<body style="background-color:blue;">
<script type="text/javascript">
function handleRedirect() {
	window.location = "http://app.thechessstore.com";
	console.log("var Function was added");
}
function bugLater(){
	sessionStorage.redirectToAppVar = true;
	$('.redirectToSiteApp').dialog('close');
	console.log("sessionStorage = " + sessionStorage.redirectToAppVar);
	console.log("localStorage = " + localStorage.redirectToAppVar);
}
function autoRedirect(){
	localStorage.redirectToAppVar = true;
	$('.redirectToSiteApp').dialog('close');
	window.location = "http://app.thechessstore.com";
}
function resetRedirectPreferences(){
	localStorage.redirectToAppVar = false;
	console.log("sessionStorage have now been set to: " + sessionStorage.redirectToAppVar);
	console.log("localStorage have now been set to: " + localStorage.redirectToAppVar);
	window.clearTimeout(autoRedirectTimer);
	$('.autoRedirectToSiteApp').dialog('close');
}



$(document).ready(function() {
	if(typeof(Storage)!=="undefined"){
		if(localStorage.redirectToAppVar){
		}
		else{
			localStorage.redirectToAppVar = false;
		}
		if(sessionStorage.redirectToAppVar){
		}
		else{
			sessionStorage.redirectToAppVar = false;
		}
		$('<div style="float:left; border:solid thick" class="redirectToSiteApp"> '+
		'<h3 style="float:left; text-align:center; width:100%;">Would you like to try out our new app site&#63;</h3>' +
		'<div style="width:100%; height:170px; float:left; clear:both;">' +
			'<img style="margin-left:110px;" src="logo.png" />' +
		'</div>' +
		'<button onclick="handleRedirect(); return false;" style="float:left;">Yes</button>' +
		'<button onclick="bugLater()" style="float:left; margin-left:128px;">Remind me next time</button>' +
		'<button onclick="autoRedirect()" style="float:left; margin-top:10px;">Always redirect to app site when visiting this site</button>' +
		//'<button onclick="resetRedirectPreferences()">Reset Preferences</button>' +
		'</div>').appendTo('head');
		
		if(typeof(Storage)!=="undefined"){
			console.log("storage exists check passed");
			if(localStorage.redirectToAppVar == "true"){
				$('<div style="background-color:white; float:left;" class="autoRedirectToSiteApp"> '+
				'<h3 style="float:left; text-align:center; width:100%;">Redirecting to app site. Please wait a few Seconds....</h3>' +
				'<div style="width:100% float:left; clear:both;">' +
					'<img style="margin-left:175px; margin-top:20px;" src="loading.gif.gif" />' +
				'</div>' +
				'<button style="float:left; margin-top:10px;" onclick="resetRedirectPreferences()">Prompt me next time instead of auto-redirecting</button>' +
				'</div>').appendTo('head');
				$('.autoRedirectToSiteApp').dialog({'modal':'true', 'width':400, height:270});
				var redirectTimer;
				function foo1(){
					window.location = "http://app.thechessstore.com";
				}
				redirectTimer = foo1;
				var autoRedirectTimer;
				autoRedirectTimer = setTimeout(redirectTimer, 5000);
			}
			else if (sessionStorage.redirectToAppVar == "true"){
				console.log("One of the two storage values was true, redirect modal is not displaying.");
			}
			else{
				$('.redirectToSiteApp').dialog({'modal':'true', 'width':450, height:430});
				console.log("Neither storage value was true, displaying redirect modal");
				console.log("sessionStorage = " + sessionStorage.redirectToAppVar);
				console.log("localStorage = " + localStorage.redirectToAppVar);
			}
		}
	}
	else{
		console.log("Storage is not supported");
	}
});
</script>
<div style=""></div>
</body>
</html>
